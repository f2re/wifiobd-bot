# üéØ –ü–æ–¥—Ä–æ–±–Ω—ã–π –ø–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Telegram-–±–æ—Ç–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å OpenCart

–°–æ–∑–¥–∞–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ Telegram-–±–æ—Ç–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –º–∞–≥–∞–∑–∏–Ω–æ–º [wifiobd.ru](https://wifiobd.ru) (OpenCart 3.0.2.0) –Ω–∞ –±–∞–∑–µ –≤–∞—à–µ–π [–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã telegram-bots-platform](https://github.com/f2re/telegram-bots-platform).

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

### –í—ã–±–æ—Ä —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- **–Ø–∑—ã–∫**: Python 3.11+
- **–§—Ä–µ–π–º–≤–æ—Ä–∫ –±–æ—Ç–∞**: aiogram 3.x (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π)
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL (—É–∂–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É)
- **–ö—ç—à**: Redis (–¥–ª—è —Å–µ—Å—Å–∏–π –∏ –∫–æ—Ä–∑–∏–Ω—ã)
- **API –∫–ª–∏–µ–Ω—Ç**: aiohttp –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ü–ª–∞—Ç–µ–∂–∏**: YooMoney API (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ yoomoney)
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**: Docker Compose


### –ú–µ—Ç–æ–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å OpenCart

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (API + –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ë–î)**

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**

- **API OpenCart** - –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤)
- **–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ë–î** - –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Ç–æ–≤–∞—Ä—ã) - –±—ã—Å—Ç—Ä–µ–µ –∏ –Ω–∞–¥–µ–∂–Ω–µ–µ
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ë–î** - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π OpenCart –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –±–æ—Ç–µ


## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
wifiobd-bot/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ settings.py          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ opencart_db.py       # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î OpenCart
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ bot.py               # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ handlers/            # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ start.py         # /start, –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ catalog.py       # –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ —Ç–æ–≤–∞—Ä–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cart.py          # –ö–æ—Ä–∑–∏–Ω–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ checkout.py      # –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payment.py       # –û–ø–ª–∞—Ç–∞ YooMoney
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin.py         # –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ keyboards/           # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ inline.py        # Inline –∫–Ω–æ–ø–∫–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ reply.py         # Reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ)
‚îÇ   ‚îú‚îÄ‚îÄ services/            # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ opencart.py      # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenCart
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ catalog.py       # –†–∞–±–æ—Ç–∞ —Å –∫–∞—Ç–∞–ª–æ–≥–æ–º
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cart.py          # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω–æ–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ order.py         # –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py          # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ yoomoney.py      # –ü–ª–∞—Ç–µ–∂–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database/            # –†–∞–±–æ—Ç–∞ —Å –ë–î
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py        # SQLAlchemy –º–æ–¥–µ–ª–∏ (—Å–≤–æ—è –ë–î)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ opencart_models.py # –ú–æ–¥–µ–ª–∏ –¥–ª—è OpenCart –ë–î
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ queries.py       # –ó–∞–ø—Ä–æ—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/         # Middleware
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ throttling.py    # –ê–Ω—Ç–∏—Å–ø–∞–º
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.py          # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ filters/             # –§–∏–ª—å—Ç—Ä—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin.py         # –§–∏–ª—å—Ç—Ä –∞–¥–º–∏–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ states/              # FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ checkout.py      # –°–æ—Å—Ç–æ—è–Ω–∏—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin.py         # –°–æ—Å—Ç–æ—è–Ω–∏—è –∞–¥–º–∏–Ω–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ utils/               # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ       ‚îú‚îÄ‚îÄ formatting.py    # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
‚îÇ       ‚îú‚îÄ‚îÄ pagination.py    # –ü–∞–≥–∏–Ω–∞—Ü–∏—è
‚îÇ       ‚îî‚îÄ‚îÄ logger.py        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ migrations/              # Alembic –º–∏–≥—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ tests/                   # –¢–µ—Å—Ç—ã
```


## –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (1-2 –¥–Ω—è)

#### 1.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å telegram-bots-platform
sudo ./add-bot.sh
# –ù–∞–∑–≤–∞–Ω–∏–µ: wifiobd-bot
# –¢–∏–ø: Python bot —Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
# –ü–æ—Ä—Ç: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```


#### 1.2 –°–æ–∑–¥–∞–Ω–∏–µ docker-compose.yml

```yaml
version: '3.8'
services:
  bot:
    build: .
    container_name: wifiobd_bot
    restart: unless-stopped
    env_file: .env
    volumes:
      - ./app:/app
      - ./logs:/logs
    networks:
      - bot_network
      - postgres_network
    depends_on:
      - redis
      - postgres

  redis:
    image: redis:7-alpine
    restart: unless-stopped
    volumes:
      - redis_data:/data
    networks:
      - bot_network

  # PostgreSQL —É–∂–µ –≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ, –ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –Ω–µ–º—É

networks:
  bot_network:
  postgres_network:
    external: true
    name: platform_postgres_network

volumes:
  redis_data:
```


#### 1.3 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î OpenCart

- –°–æ–∑–¥–∞—Ç—å read-only –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —á—Ç–µ–Ω–∏—è OpenCart –ë–î
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å VPN/SSH —Ç—É–Ω–Ω–µ–ª—å –µ—Å–ª–∏ –ë–î –Ω–∞ –¥—Ä—É–≥–æ–º —Å–µ—Ä–≤–µ—Ä–µ
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ


### –≠—Ç–∞–ø 2: –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenCart (3-4 –¥–Ω—è)

#### 2.1 –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

**–°–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è –ë–î –±–æ—Ç–∞:**

```python
# database/models.py
class User(Base):
    id = Column(BigInteger, primary_key=True)  # Telegram ID
    opencart_customer_id = Column(Integer, nullable=True)
    username = Column(String(255))
    first_name = Column(String(255))
    phone = Column(String(20))
    email = Column(String(255))
    created_at = Column(DateTime, default=datetime.utcnow)

class Cart(Base):
    id = Column(Integer, primary_key=True)
    user_id = Column(BigInteger, ForeignKey('users.id'))
    product_id = Column(Integer)  # OpenCart product_id
    quantity = Column(Integer)
    options = Column(JSON)  # –û–ø—Ü–∏–∏ —Ç–æ–≤–∞—Ä–∞

class Order(Base):
    id = Column(Integer, primary_key=True)
    user_id = Column(BigInteger, ForeignKey('users.id'))
    opencart_order_id = Column(Integer)
    yoomoney_payment_id = Column(String(255))
    amount = Column(Numeric(10, 2))
    status = Column(String(50))  # pending, paid, cancelled
    created_at = Column(DateTime)

class SupportTicket(Base):
    id = Column(Integer, primary_key=True)
    user_id = Column(BigInteger, ForeignKey('users.id'))
    message = Column(Text)
    admin_response = Column(Text, nullable=True)
    status = Column(String(20))
    created_at = Column(DateTime)
```

**–ú–æ–¥–µ–ª–∏ OpenCart (read-only):**

```python
# database/opencart_models.py
class OCCategory(Base):
    __tablename__ = 'oc_category'
    category_id = Column(Integer, primary_key=True)
    parent_id = Column(Integer)
    sort_order = Column(Integer)
    status = Column(Boolean)

class OCCategoryDescription(Base):
    __tablename__ = 'oc_category_description'
    category_id = Column(Integer, primary_key=True)
    language_id = Column(Integer, primary_key=True)
    name = Column(String(255))

class OCProduct(Base):
    __tablename__ = 'oc_product'
    product_id = Column(Integer, primary_key=True)
    model = Column(String(64))
    price = Column(Numeric(15, 4))
    quantity = Column(Integer)
    status = Column(Boolean)
    image = Column(String(255))

class OCProductDescription(Base):
    __tablename__ = 'oc_product_description'
    product_id = Column(Integer, primary_key=True)
    name = Column(String(255))
    description = Column(Text)

class OCCustomer(Base):
    __tablename__ = 'oc_customer'
    customer_id = Column(Integer, primary_key=True)
    email = Column(String(96))
    telephone = Column(String(32))
```


#### 2.2 –°–µ—Ä–≤–∏—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å OpenCart

```python
# services/opencart.py
class OpenCartService:
    def __init__(self):
        self.api_url = settings.OPENCART_API_URL
        self.api_token = settings.OPENCART_API_TOKEN
        self.db_engine = create_engine(settings.OPENCART_DB_URL)

    # –ß—Ç–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ë–î (–±—ã—Å—Ç—Ä–µ–µ)
    async def get_categories(self, parent_id=0):
        """–ü–æ–ª—É—á–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ –ë–î OpenCart"""

    async def get_products_by_category(self, category_id, limit=10, offset=0):
        """–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"""

    async def get_product_details(self, product_id):
        """–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ"""

    # –ó–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ API (–±–µ–∑–æ–ø–∞—Å–Ω–µ–µ)
    async def create_customer(self, user_data):
        """–°–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –≤ OpenCart —á–µ—Ä–µ–∑ API"""

    async def create_order(self, order_data):
        """–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ API"""

    async def update_order_status(self, order_id, status_id):
        """–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞"""
```


### –≠—Ç–∞–ø 3: –ö–∞—Ç–∞–ª–æ–≥ –∏ –∫–æ—Ä–∑–∏–Ω–∞ (2-3 –¥–Ω—è)

#### 3.1 –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–∞

**UX/UI –ø—Ä–∏–Ω—Ü–∏–ø—ã:**

- ‚úÖ –ú–∏–Ω–∏–º—É–º —Ç–µ–∫—Å—Ç–∞, –º–∞–∫—Å–∏–º—É–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- ‚úÖ –≠–º–æ–¥–∑–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏: üè† üìÅ üõí üí≥ ‚öôÔ∏è
- ‚úÖ Inline –∫–Ω–æ–ø–∫–∏ —Å callback_data
- ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏ ‚óÄÔ∏è 1/5 ‚ñ∂Ô∏è
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- ‚úÖ "–•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏" –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è

```python
# handlers/catalog.py
@router.callback_query(F.data == "catalog")
async def show_categories(callback: CallbackQuery):
    """–ü–æ–∫–∞–∑–∞—Ç—å –∫–æ—Ä–Ω–µ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"""
    categories = await catalog_service.get_root_categories()

    keyboard = InlineKeyboardBuilder()
    for cat in categories:
        keyboard.button(
            text=f"üìÅ {cat.name}",
            callback_data=f"cat:{cat.id}"
        )
    keyboard.button(text="üè† –ì–ª–∞–≤–Ω–∞—è", callback_data="start")
    keyboard.adjust(2)  # 2 –∫–Ω–æ–ø–∫–∏ –≤ —Ä—è–¥

    await callback.message.edit_text(
        "üìÇ <b>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:</b>",
        reply_markup=keyboard.as_markup()
    )

@router.callback_query(F.data.startswith("cat:"))
async def show_category(callback: CallbackQuery):
    """–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –∏–ª–∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏"""
    category_id = int(callback.data.split(":")[^1])

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    subcats = await catalog_service.get_subcategories(category_id)
    if subcats:
        # –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        pass
    else:
        # –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–≤–∞—Ä—ã —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
        products = await catalog_service.get_products(
            category_id,
            page=0
        )
        await show_products(callback.message, products, category_id, 0)

async def show_products(message, products, category_id, page):
    """–û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ç–æ–≤–∞—Ä—ã —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π"""
    keyboard = InlineKeyboardBuilder()

    for product in products:
        keyboard.button(
            text=f"{product.name} - {product.price}‚ÇΩ",
            callback_data=f"prod:{product.id}"
        )

    # –ü–∞–≥–∏–Ω–∞—Ü–∏—è
    nav_row = []
    if page > 0:
        nav_row.append(InlineKeyboardButton(
            text="‚óÄÔ∏è",
            callback_data=f"catpage:{category_id}:{page-1}"
        ))
    nav_row.append(InlineKeyboardButton(
        text=f"{page+1}",
        callback_data="noop"
    ))
    if len(products) == 10:  # –ü–æ–ª–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
        nav_row.append(InlineKeyboardButton(
            text="‚ñ∂Ô∏è",
            callback_data=f"catpage:{category_id}:{page+1}"
        ))

    keyboard.row(*nav_row)
    keyboard.button(text="üîô –ù–∞–∑–∞–¥", callback_data=f"cat:{category_id}")
    keyboard.adjust(1)

    await message.edit_text(
        "üõç <b>–¢–æ–≤–∞—Ä—ã:</b>",
        reply_markup=keyboard.as_markup()
    )
```


#### 3.2 –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞

```python
@router.callback_query(F.data.startswith("prod:"))
async def show_product(callback: CallbackQuery):
    """–î–µ—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞"""
    product_id = int(callback.data.split(":")[^1])
    product = await catalog_service.get_product_details(product_id)

    # –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ –µ—Å–ª–∏ –µ—Å—Ç—å
    if product.image:
        photo_url = f"{settings.OPENCART_URL}/image/{product.image}"

    text = f"""
<b>{product.name}</b>

{product.description[:300]}...

üí∞ <b>–¶–µ–Ω–∞:</b> {product.price}‚ÇΩ
üì¶ <b>–í –Ω–∞–ª–∏—á–∏–∏:</b> {product.quantity} —à—Ç
"""

    keyboard = InlineKeyboardBuilder()
    keyboard.button(text="‚ûï –í –∫–æ—Ä–∑–∏–Ω—É", callback_data=f"addcart:{product_id}")
    keyboard.button(text="üîô –ù–∞–∑–∞–¥", callback_data=f"cat:{product.category_id}")
    keyboard.adjust(1)

    if product.image:
        await callback.message.delete()
        await callback.message.answer_photo(
            photo=photo_url,
            caption=text,
            reply_markup=keyboard.as_markup()
        )
    else:
        await callback.message.edit_text(
            text,
            reply_markup=keyboard.as_markup()
        )
```


#### 3.3 –ö–æ—Ä–∑–∏–Ω–∞

```python
# services/cart.py
class CartService:
    def __init__(self, redis_client):
        self.redis = redis_client

    async def add_item(self, user_id, product_id, quantity=1):
        """–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É"""
        key = f"cart:{user_id}"
        await self.redis.hincrby(key, product_id, quantity)
        await self.redis.expire(key, 86400 * 7)  # 7 –¥–Ω–µ–π

    async def get_cart(self, user_id):
        """–ü–æ–ª—É—á–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É"""
        key = f"cart:{user_id}"
        cart = await self.redis.hgetall(key)

        # –û–±–æ–≥–∞—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–º–∏ –æ —Ç–æ–≤–∞—Ä–∞—Ö
        products = []
        total = 0
        for product_id, qty in cart.items():
            product = await catalog_service.get_product(product_id)
            products.append({
                "product": product,
                "quantity": int(qty),
                "subtotal": product.price * int(qty)
            })
            total += product.price * int(qty)

        return {"items": products, "total": total}
```


### –≠—Ç–∞–ø 4: –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ (2-3 –¥–Ω—è)

#### 4.1 FSM –¥–ª—è checkout

```python
# states/checkout.py
class CheckoutStates(StatesGroup):
    waiting_name = State()
    waiting_phone = State()
    waiting_address = State()
    waiting_comment = State()
    confirm = State()
```


#### 4.2 –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ checkout

```python
# handlers/checkout.py
@router.callback_query(F.data == "checkout")
async def start_checkout(callback: CallbackQuery, state: FSMContext):
    """–ù–∞—á–∞—Ç—å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞"""
    cart = await cart_service.get_cart(callback.from_user.id)

    if not cart["items"]:
        await callback.answer("üõí –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞", show_alert=True)
        return

    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ OpenCart
    user = await user_service.get_user(callback.from_user.id)
    if not user.opencart_customer_id:
        # –°–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –≤ OpenCart
        oc_customer = await opencart_service.create_customer({
            "firstname": user.first_name,
            "email": user.email or f"tg{user.id}@temp.com",
            "telephone": user.phone or ""
        })
        await user_service.update_opencart_id(user.id, oc_customer["customer_id"])

    await state.set_state(CheckoutStates.waiting_phone)
    await callback.message.edit_text(
        "üìû –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:",
        reply_markup=skip_keyboard()
    )

@router.message(CheckoutStates.waiting_phone)
async def process_phone(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞"""
    await state.update_data(phone=message.text)
    await state.set_state(CheckoutStates.waiting_address)

    await message.answer(
        "üìç –í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:",
        reply_markup=skip_keyboard()
    )

# ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏

@router.callback_query(F.data == "confirm_order", CheckoutStates.confirm)
async def confirm_order(callback: CallbackQuery, state: FSMContext):
    """–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞"""
    data = await state.get_data()
    cart = await cart_service.get_cart(callback.from_user.id)

    # –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ –≤ —Å–≤–æ–µ–π –ë–î
    order = await order_service.create_order(
        user_id=callback.from_user.id,
        cart=cart,
        delivery_data=data
    )

    await state.clear()

    # –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ
    await initiate_payment(callback, order)
```


### –≠—Ç–∞–ø 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è YooMoney (2-3 –¥–Ω—è)

#### 5.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ YooMoney

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ https://yoomoney.ru/myservices/new
2. –ü–æ–ª—É—á–∏—Ç—å `client_id`
3. –í—ã–ø—É—Å—Ç–∏—Ç—å —Ç–æ–∫–µ–Ω —Å –ø—Ä–∞–≤–∞–º–∏: `payment-p2p`, `operation-history`

#### 5.2 –°–µ—Ä–≤–∏—Å –æ–ø–ª–∞—Ç—ã

```python
# services/yoomoney.py
from yoomoney import Client, Quickpay

class YooMoneyService:
    def __init__(self):
        self.client = Client(settings.YOOMONEY_TOKEN)
        self.wallet = settings.YOOMONEY_WALLET

    async def create_payment(self, order_id, amount):
        """–°–æ–∑–¥–∞—Ç—å —Å—á–µ—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É"""
        label = f"order_{order_id}_{int(time.time())}"

        quickpay = Quickpay(
            receiver=self.wallet,
            quickpay_form="shop",
            targets=f"–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞ #{order_id}",
            paymentType="SB",
            sum=amount,
            label=label
        )

        # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å label –≤ –ë–î –∑–∞–∫–∞–∑–∞
        await order_service.update_payment_label(order_id, label)

        return {
            "payment_url": quickpay.redirected_url,
            "label": label
        }

    async def check_payment(self, label):
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞"""
        history = self.client.operation_history(label=label)

        if history.operations:
            for operation in history.operations:
                if operation.status == "success":
                    return {
                        "status": "success",
                        "amount": operation.amount,
                        "datetime": operation.datetime
                    }

        return {"status": "pending"}
```


#### 5.3 –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø–ª–∞—Ç—ã

```python
# handlers/payment.py
async def initiate_payment(callback: CallbackQuery, order):
    """–ò–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –æ–ø–ª–∞—Ç—É"""
    payment = await yoomoney_service.create_payment(
        order.id,
        order.amount
    )

    keyboard = InlineKeyboardBuilder()
    keyboard.button(
        text="üí≥ –û–ø–ª–∞—Ç–∏—Ç—å",
        url=payment["payment_url"]
    )
    keyboard.button(
        text="‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É",
        callback_data=f"checkpay:{order.id}"
    )
    keyboard.button(
        text="‚ùå –û—Ç–º–µ–Ω–∏—Ç—å",
        callback_data=f"cancelpay:{order.id}"
    )
    keyboard.adjust(1)

    await callback.message.edit_text(
        f"""
üí∞ <b>–ó–∞–∫–∞–∑ ‚Ññ{order.id}</b>

–°—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ: <b>{order.amount}‚ÇΩ</b>

–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –¥–ª—è –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ –ÆMoney.
–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É".
""",
        reply_markup=keyboard.as_markup()
    )

@router.callback_query(F.data.startswith("checkpay:"))
async def check_payment(callback: CallbackQuery):
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É"""
    order_id = int(callback.data.split(":")[^1])
    order = await order_service.get_order(order_id)

    payment_status = await yoomoney_service.check_payment(
        order.yoomoney_label
    )

    if payment_status["status"] == "success":
        # –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
        await order_service.update_status(order_id, "paid")

        # –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ –≤ OpenCart
        oc_order = await opencart_service.create_order({
            "customer_id": order.user.opencart_customer_id,
            "products": order.items,
            "total": order.amount,
            "payment_method": "YooMoney",
            "shipping_address": order.address
        })

        await order_service.update_opencart_order_id(
            order_id,
            oc_order["order_id"]
        )

        await callback.message.edit_text(
            f"""
‚úÖ <b>–û–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–∞!</b>

–ó–∞–∫–∞–∑ ‚Ññ{oc_order['order_id']} –ø—Ä–∏–Ω—è—Ç –≤ –æ–±—Ä–∞–±–æ—Ç–∫—É.
–û–∂–∏–¥–∞–π—Ç–µ –∑–≤–æ–Ω–∫–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞.

<b>–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–∫—É–ø–∫—É!</b> üéâ
""",
            reply_markup=main_menu_keyboard()
        )
    else:
        await callback.answer(
            "‚è≥ –û–ø–ª–∞—Ç–∞ –µ—â–µ –Ω–µ –ø–æ—Å—Ç—É–ø–∏–ª–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É.",
            show_alert=True
        )
```


### –≠—Ç–∞–ø 6: –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (2-3 –¥–Ω—è)

#### 6.1 –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∞–¥–º–∏–Ω–∫–∏

```python
# handlers/admin.py
@router.message(Command("admin"))
async def admin_menu(message: Message):
    """–ê–¥–º–∏–Ω –º–µ–Ω—é"""
    if not await is_admin(message.from_user.id):
        return

    keyboard = InlineKeyboardBuilder()
    keyboard.button(text="üìã –ó–∞–∫–∞–∑—ã", callback_data="admin:orders")
    keyboard.button(text="üí¨ –û–±—Ä–∞—â–µ–Ω–∏—è", callback_data="admin:tickets")
    keyboard.button(text="üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏", callback_data="admin:users")
    keyboard.button(text="üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data="admin:stats")
    keyboard.adjust(2)

    await message.answer(
        "‚öôÔ∏è <b>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</b>",
        reply_markup=keyboard.as_markup()
    )

@router.callback_query(F.data == "admin:orders")
async def admin_orders(callback: CallbackQuery):
    """–°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤"""
    orders = await order_service.get_recent_orders(limit=10)

    text = "<b>üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã:</b>\n\n"
    keyboard = InlineKeyboardBuilder()

    for order in orders:
        text += f"#{order.id} - {order.amount}‚ÇΩ - {order.status}\n"
        keyboard.button(
            text=f"–ó–∞–∫–∞–∑ #{order.id}",
            callback_data=f"admin:order:{order.id}"
        )

    keyboard.button(text="üîô –ù–∞–∑–∞–¥", callback_data="admin:menu")
    keyboard.adjust(1)

    await callback.message.edit_text(
        text,
        reply_markup=keyboard.as_markup()
    )

@router.callback_query(F.data.startswith("admin:order:"))
async def admin_order_details(callback: CallbackQuery):
    """–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞"""
    order_id = int(callback.data.split(":")[^2])
    order = await order_service.get_order_full(order_id)

    text = f"""
<b>–ó–∞–∫–∞–∑ #{order.id}</b>

üë§ –ö–ª–∏–µ–Ω—Ç: {order.user.first_name}
üìû –¢–µ–ª–µ—Ñ–æ–Ω: {order.phone}
üìç –ê–¥—Ä–µ—Å: {order.address}

üí∞ –°—É–º–º–∞: {order.amount}‚ÇΩ
üì¶ –°—Ç–∞—Ç—É—Å: {order.status}

<b>–¢–æ–≤–∞—Ä—ã:</b>
{format_order_items(order.items)}
"""

    keyboard = InlineKeyboardBuilder()
    if order.status == "paid":
        keyboard.button(
            text="‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –æ–ø–ª–∞—Ç—É",
            callback_data=f"admin:refund:{order.id}"
        )
    keyboard.button(
        text="üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—É",
        callback_data=f"admin:msg:{order.user_id}"
    )
    keyboard.button(text="üîô –ù–∞–∑–∞–¥", callback_data="admin:orders")
    keyboard.adjust(1)

    await callback.message.edit_text(
        text,
        reply_markup=keyboard.as_markup()
    )

@router.callback_query(F.data.startswith("admin:refund:"))
async def admin_refund(callback: CallbackQuery, state: FSMContext):
    """–û—Ç–º–µ–Ω–∞ –ø–ª–∞—Ç–µ–∂–∞"""
    order_id = int(callback.data.split(":")[^2])

    # –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤ –ë–î
    await order_service.update_status(order_id, "refunded")

    # –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤ OpenCart
    order = await order_service.get_order(order_id)
    if order.opencart_order_id:
        await opencart_service.update_order_status(
            order.opencart_order_id,
            7  # Cancelled
        )

    # –£–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    await bot.send_message(
        order.user_id,
        f"‚ùå –ó–∞–∫–∞–∑ #{order.id} –æ—Ç–º–µ–Ω–µ–Ω. –°—Ä–µ–¥—Å—Ç–≤–∞ –±—É–¥—É—Ç –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã."
    )

    await callback.answer("‚úÖ –ü–ª–∞—Ç–µ–∂ –æ—Ç–º–µ–Ω–µ–Ω", show_alert=True)

# –û–±—Ä–∞—â–µ–Ω–∏—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É
@router.callback_query(F.data == "support")
async def create_support_ticket(callback: CallbackQuery, state: FSMContext):
    """–°–æ–∑–¥–∞—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–µ"""
    await state.set_state(SupportStates.waiting_message)
    await callback.message.edit_text(
        "üí¨ –û–ø–∏—à–∏—Ç–µ –≤–∞—à—É –ø—Ä–æ–±–ª–µ–º—É:"
    )

@router.message(SupportStates.waiting_message)
async def save_support_ticket(message: Message, state: FSMContext):
    """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–µ"""
    ticket = await support_service.create_ticket(
        user_id=message.from_user.id,
        message=message.text
    )

    # –£–≤–µ–¥–æ–º–∏—Ç—å –∞–¥–º–∏–Ω–æ–≤
    for admin_id in settings.ADMIN_IDS:
        await bot.send_message(
            admin_id,
            f"üÜò –ù–æ–≤–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ #{ticket.id}\n\n{message.text}",
            reply_markup=InlineKeyboardMarkup(inline_keyboard=[[
                InlineKeyboardButton(
                    text="–û—Ç–≤–µ—Ç–∏—Ç—å",
                    callback_data=f"admin:reply:{ticket.id}"
                )
            ]])
        )

    await message.answer(
        f"‚úÖ –û–±—Ä–∞—â–µ–Ω–∏–µ #{ticket.id} —Å–æ–∑–¥–∞–Ω–æ.\n–û–∂–∏–¥–∞–π—Ç–µ –æ—Ç–≤–µ—Ç–∞."
    )
    await state.clear()
```


### –≠—Ç–∞–ø 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (2-3 –¥–Ω—è)

#### 7.1 –ß–µ–∫-–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

- ‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–∞—Ç–∞–ª–æ–≥—É (–≤—Å–µ —É—Ä–æ–≤–Ω–∏ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω—É
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ
- ‚úÖ –ü—Ä–æ—Ü–µ—Å—Å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
- ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ YooMoney (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)
- ‚úÖ –û—Ç–º–µ–Ω–∞ –ø–ª–∞—Ç–µ–∂–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ OpenCart
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤ OpenCart
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
- ‚úÖ –†–∞–±–æ—Ç–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
- ‚úÖ –û—Ç–≤–µ—Ç—ã –Ω–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è
- ‚úÖ –ê–Ω—Ç–∏—Å–ø–∞–º (throttling)

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∏–∑ OpenCart –ë–î
- ‚úÖ API –≤—ã–∑–æ–≤—ã –∫ OpenCart
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π YooMoney
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ —Å –ø–æ–ª–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π

**–ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

- ‚úÖ 100+ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –†–∞–±–æ—Ç–∞ Redis –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ


#### 7.2 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

```python
# –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞
@lru_cache(maxsize=128)
async def get_cached_categories():
    """–ö—ç—à –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–∞ 1 —á–∞—Å"""
    return await catalog_service.get_categories()

# Batch –æ–ø–µ—Ä–∞—Ü–∏–∏
async def get_products_batch(product_ids):
    """–ü–æ–ª—É—á–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å"""
    query = select(OCProduct).where(
        OCProduct.product_id.in_(product_ids)
    )
    return await db.execute(query)
```


### –≠—Ç–∞–ø 8: –î–µ–ø–ª–æ–π –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (1 –¥–µ–Ω—å)

#### 8.1 –î–µ–ø–ª–æ–π

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /opt/telegram-bots-platform/bots/wifiobd-bot
docker compose up -d --build

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker compose logs -f bot

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
./monitor-status.sh
```


#### 8.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤ Prometheus:
    - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –≤ —á–∞—Å
    - –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ –±–æ—Ç–∞
    - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ API
    - –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –ø–ª–∞—Ç–µ–∂–µ–π
- –°–æ–∑–¥–∞—Ç—å dashboard –≤ Grafana —Å:
    - –ì—Ä–∞—Ñ–∏–∫–∞–º–∏ –ø—Ä–æ–¥–∞–∂
    - –ê–∫—Ç–∏–≤–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
    - –°—Ç–∞—Ç—É—Å–∞–º–∏ –∑–∞–∫–∞–∑–æ–≤


## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```ini
# .env
BOT_TOKEN=your_telegram_bot_token
ADMIN_IDS=123456789,987654321

# OpenCart API
OPENCART_URL=https://wifiobd.ru
OPENCART_API_URL=https://wifiobd.ru/index.php?route=api
OPENCART_API_TOKEN=your_opencart_api_token

# OpenCart Database (read-only)
OPENCART_DB_HOST=localhost
OPENCART_DB_PORT=3306
OPENCART_DB_NAME=opencart
OPENCART_DB_USER=readonly_user
OPENCART_DB_PASSWORD=secure_password

# Bot Database (PostgreSQL)
DB_HOST=postgres
DB_PORT=5432
DB_NAME=wifiobd_bot_db
DB_USER=wifiobd_bot
DB_PASSWORD=generated_password

# Redis
REDIS_HOST=redis
REDIS_PORT=6379

# YooMoney
YOOMONEY_TOKEN=your_yoomoney_token
YOOMONEY_WALLET=410011234567890
YOOMONEY_CLIENT_ID=your_client_id
```


## –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞ —Å—Ä–æ–∫–æ–≤

- **–≠—Ç–∞–ø 1**: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ - 2 –¥–Ω—è
- **–≠—Ç–∞–ø 2**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è OpenCart - 4 –¥–Ω—è
- **–≠—Ç–∞–ø 3**: –ö–∞—Ç–∞–ª–æ–≥ –∏ –∫–æ—Ä–∑–∏–Ω–∞ - 3 –¥–Ω—è
- **–≠—Ç–∞–ø 4**: –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ - 3 –¥–Ω—è
- **–≠—Ç–∞–ø 5**: YooMoney - 3 –¥–Ω—è
- **–≠—Ç–∞–ø 6**: –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - 3 –¥–Ω—è
- **–≠—Ç–∞–ø 7**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ - 3 –¥–Ω—è
- **–≠—Ç–∞–ø 8**: –î–µ–ø–ª–æ–π - 1 –¥–µ–Ω—å

**–ò—Ç–æ–≥–æ: 22 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è (~1 –º–µ—Å—è—Ü)**

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å read-only –¥–æ—Å—Ç—É–ø –∫ –ë–î OpenCart
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ Rate limiting (–∞–Ω—Ç–∏—Å–ø–∞–º)
- ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ HTTPS –¥–ª—è –≤—Å–µ—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –ë—ç–∫–∞–ø—ã –ë–î –µ–∂–µ–¥–Ω–µ–≤–Ω–æ

–≠—Ç–æ—Ç –ø–ª–∞–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é, –Ω–∞–¥–µ–∂–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –æ—Ç–ª–∏—á–Ω—ã–º UX –∏ –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –Ω–∞–¥ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏.
